<!DOCTYPE html>
<html>
  <head>
    <title>Soffioni test con pallini colorati</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #nameLabel {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(255, 255, 255, 0.8);
        padding: 10px 20px;
        border-radius: 10px;
        font-family: sans-serif;
        font-size: 18px;
        display: none;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <div id="nameLabel"></div>
    <a-scene embedded>
      <a-entity id="semiContainer"></a-entity>
      <a-entity camera look-controls></a-entity>
    </a-scene>

    <script>
      const semiContainer = document.querySelector('#semiContainer');
      const names = [
        "Nicola", "Denny", "Vadim", "Dimitri", "Peppino", "Gioele",
        "Laura", "Marina", "Nina", "Alessandro", "Nicola", "Valentina",
        "Ivan", "Galina", "Bartolo", "Olga", "Igor", "Lidia",
        "Capitalina", "Dimitri", "Ludmila", "Anna", "Padre Gennadij",
        "Alessandro", "Cirillo", "Maria", "Alfredo", "Pino"
      ];

      const colors = [
        'red', 'orange', 'yellow', 'lime', 'cyan', 'blue',
        'purple', 'magenta', 'pink', 'brown', 'gray', 'white',
        'teal', 'navy', 'maroon', 'olive', 'silver', 'gold',
        'coral', 'crimson', 'indigo', 'lavender', 'salmon',
        'tan', 'orchid', 'plum', 'khaki', 'aqua'
      ];

      const semiData = [];

      for (let i = 0; i < 28; i++) {
        const angle = Math.random() * 360;
        const angleRad = angle * Math.PI / 180;
        const distance = 2 + Math.random() * 1.5;
        const yPos = Math.random() * 2 - 1;

        const sphere = document.createElement('a-sphere');
        sphere.setAttribute('radius', 0.2);
        sphere.setAttribute('color', colors[i]);
        sphere.setAttribute('position', `${Math.cos(angleRad) * distance} ${yPos} ${-Math.sin(angleRad) * distance}`);
        sphere.setAttribute('material', 'opacity: 0.8; transparent: true');

        sphere.setAttribute('onclick', `
          document.getElementById('nameLabel').innerText='${names[i]}';
          document.getElementById('nameLabel').style.display='block';
          setTimeout(() => { document.getElementById('nameLabel').style.display='none' }, 2000);
        `);

        semiContainer.appendChild(sphere);

        semiData.push({
          el: sphere,
          basePos: { x: Math.cos(angleRad) * distance, y: yPos, z: -Math.sin(angleRad) * distance },
          floatSpeed: 0.3 + Math.random() * 0.5,
          phase: Math.random() * Math.PI * 2,
          baseScale: 0.2
        });
      }

      AFRAME.registerComponent('semi-fluttuanti', {
        tick: function (time, timeDelta) {
          semiData.forEach(data => {
            const t = time / 1000;

            const offsetX = Math.sin(t * data.floatSpeed + data.phase) * 0.2;
            const offsetY = Math.sin(t * (data.floatSpeed / 2) + data.phase) * 0.05;
            const offsetZ = Math.cos(t * data.floatSpeed + data.phase) * 0.3;

            const newX = data.basePos.x + offsetX;
            const newY = data.basePos.y + offsetY;
            const newZ = data.basePos.z + offsetZ;

            data.el.setAttribute('position', `${newX} ${newY} ${newZ}`);

            // scala proporzionale a profondit√†
            const scaleFactor = 1 / (1 + Math.abs(newZ));
            const scale = data.baseScale * scaleFactor;
            data.el.setAttribute('scale', `${scale} ${scale} ${scale}`);
          });
        }
      });

      semiContainer.setAttribute('semi-fluttuanti', '');
    </script>
  </body>
</html>
