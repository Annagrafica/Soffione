<!DOCTYPE html>
<html>
  <head>
    <title>Soffioni con Webcam Sfondo</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style> body, html { margin:0; padding:0; overflow:hidden; height:100%; } </style>
  </head>
  <body>

    <a-scene embedded>
      <a-assets>
        <video id="webcam" autoplay playsinline muted></video>
      </a-assets>

      <!-- Piano con webcam come texture -->
      <a-plane position="0 1.6 -3" rotation="0 0 0" width="16" height="9" material="shader: flat; src: #webcam"></a-plane>

      <!-- Semi volanti -->
      <a-entity id="semiContainer"></a-entity>

      <!-- Camera -->
      <a-entity camera position="0 1.6 0"></a-entity>
    </a-scene>

    <script>
      // Attiva la webcam e collega al video nell'a-assets
      const video = document.querySelector("#webcam");
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          video.srcObject = stream;
          video.play();
          console.log("Webcam attiva");
        })
        .catch(err => {
          console.error("Errore accesso webcam:", err);
        });

      // Crea semi semplici
      const semiContainer = document.querySelector('#semiContainer');
      const semiData = [];

      for(let i=0; i<10; i++) {
        const angle = Math.random() * 2 * Math.PI;
        const distance = 1 + Math.random();
        const y = Math.random() * 2;

        const aBox = document.createElement('a-box');
        aBox.setAttribute('color', 'yellow');
        aBox.setAttribute('depth', 0.1);
        aBox.setAttribute('height', 0.1);
        aBox.setAttribute('width', 0.1);
        aBox.setAttribute('position', `${Math.cos(angle)*distance} ${y} ${Math.sin(angle)*distance}`);

        semiContainer.appendChild(aBox);

        semiData.push({
          el: aBox,
          basePos: { x: Math.cos(angle)*distance, y: y, z: Math.sin(angle)*distance },
          speed: 0.5 + Math.random(),
          phase: Math.random() * Math.PI * 2
        });
      }

      AFRAME.registerComponent('float-seeds', {
        tick: function(time) {
          const t = time / 1000;
          semiData.forEach(s => {
            const ox = Math.sin(t * s.speed + s.phase) * 0.2;
            const oy = Math.cos(t * s.speed * 0.5 + s.phase) * 0.1;
            const oz = Math.sin(t * s.speed + s.phase) * 0.2;

            s.el.setAttribute('position', `${s.basePos.x + ox} ${s.basePos.y + oy} ${s.basePos.z + oz}`);
          });
        }
      });

      semiContainer.setAttribute('float-seeds', '');
    </script>

  </body>
</html>
