<!DOCTYPE html>
<html>
<head>
  <title>Soffioni Volanti - Webcam senza Marker</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <style>
    body, html { margin:0; padding:0; overflow:hidden; height: 100%; }
    #webcamVideo {
      position: fixed; top: 0; left: 0;
      width: 100vw; height: 100vh;
      object-fit: cover;
      z-index: 0;
    }
    a-scene {
      position: fixed; top: 0; left: 0;
      width: 100vw; height: 100vh;
      z-index: 1;
      pointer-events: none; /* cos√¨ clicchi sulla webcam e non sull'Aframe */
    }
  </style>
</head>
<body>

  <!-- Video webcam visibile come sfondo -->
  <video id="webcamVideo" autoplay playsinline muted></video>

  <a-scene embedded>
    <a-entity id="semiContainer"></a-entity>
    <a-entity camera position="0 1.6 0"></a-entity>
  </a-scene>

<script>
  // Attiva la webcam come sfondo video HTML
  const video = document.getElementById('webcamVideo');
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      video.srcObject = stream;
      video.play();
      console.log("Webcam attiva");
    })
    .catch(err => {
      console.error("Errore accesso webcam:", err);
    });

  // Crea i semi soffione come immagini volanti
  const semiContainer = document.querySelector('#semiContainer');
  const semiData = [];

  for(let i = 0; i < 28; i++) {
    const angle = Math.random() * 2 * Math.PI;
    const distance = 1 + Math.random();
    const y = Math.random() * 2;

    const semi = document.createElement('a-image');
    semi.setAttribute('src', `assets/soffione${i+1}.png`);
    semi.setAttribute('width', 0.3);
    semi.setAttribute('height', 0.3);
    semi.setAttribute('position', `${Math.cos(angle) * distance} ${y} ${Math.sin(angle) * distance}`);
    semi.setAttribute('rotation', '-90 0 0');
    semi.setAttribute('material', 'alphaTest: 0.5; transparent: true');

    semiContainer.appendChild(semi);

    semiData.push({
      el: semi,
      basePos: { x: Math.cos(angle) * distance, y: y, z: Math.sin(angle) * distance },
      speed: 0.5 + Math.random(),
      phase: Math.random() * Math.PI * 2
    });
  }

  // Movimento fluttuante dei semi
  AFRAME.registerComponent('float-seeds', {
    tick: function(time) {
      const t = time / 1000;
      semiData.forEach(s => {
        const ox = Math.sin(t * s.speed + s.phase) * 0.2;
        const oy = Math.cos(t * s.speed * 0.5 + s.phase) * 0.1;
        const oz = Math.sin(t * s.speed + s.phase) * 0.2;

        s.el.setAttribute('position', `${s.basePos.x + ox} ${s.basePos.y + oy} ${s.basePos.z + oz}`);
      });
    }
  });

  semiContainer.setAttribute('float-seeds', '');
</script>

</body>
</html>
