<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Soffioni Volanti - Webcam con semi</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%; overflow: hidden;
    }
    #webcamVideo {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      object-fit: cover;
      z-index: -1; /* Video dietro tutto */
      background: black;
    }
  </style>
</head>
<body>

  <!-- Webcam esterna in background -->
  <video id="webcamVideo" autoplay playsinline muted></video>

  <!-- Scena A-Frame sopra -->
  <a-scene embedded>
    <a-entity id="semiContainer"></a-entity>
    <a-entity camera position="0 1.6 0"></a-entity>
  </a-scene>

  <script>
    // Attiva webcam esterna
    const video = document.getElementById('webcamVideo');
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        video.srcObject = stream;
        video.play();
      })
      .catch(err => {
        alert('Errore accesso webcam: ' + err.message);
      });

    // Crea semi volanti (cubetti gialli come esempio)
    const semiContainer = document.querySelector('#semiContainer');
    const semiData = [];

    for(let i = 0; i < 28; i++) {
      const angle = Math.random() * 2 * Math.PI;
      const distance = 1 + Math.random();
      const y = Math.random() * 2;

      const semi = document.createElement('a-box');
      semi.setAttribute('color', 'yellow');
      semi.setAttribute('depth', 0.1);
      semi.setAttribute('height', 0.1);
      semi.setAttribute('width', 0.1);
      semi.setAttribute('position', `${Math.cos(angle) * distance} ${y} ${Math.sin(angle) * distance}`);

      semiContainer.appendChild(semi);

      semiData.push({
        el: semi,
        basePos: { x: Math.cos(angle) * distance, y: y, z: Math.sin(angle) * distance },
        speed: 0.5 + Math.random(),
        phase: Math.random() * Math.PI * 2
      });
    }

    // Componente per far volare i semi
    AFRAME.registerComponent('float-seeds', {
      tick: function (time) {
        const t = time / 1000;
        semiData.forEach(s => {
          const ox = Math.sin(t * s.speed + s.phase) * 0.2;
          const oy = Math.cos(t * s.speed * 0.5 + s.phase) * 0.1;
          const oz = Math.sin(t * s.speed + s.phase) * 0.2;

          s.el.setAttribute('position', `${s.basePos.x + ox} ${s.basePos.y + oy} ${s.basePos.z + oz}`);
        });
      }
    });

    semiContainer.setAttribute('float-seeds', '');
  </script>

</body>
</html>
