<!DOCTYPE html>
<html>
<head>
  <title>Test Webcam + A-Frame Semi</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <style>
    body, html { margin:0; padding:0; overflow:hidden; height: 100%; }
    #webcamVideo {
      position: fixed; top: 0; left: 0;
      width: 320px; height: 240px;
      border: 2px solid green;
      z-index: 1000;
      background: black;
    }
  </style>
</head>
<body>

  <!-- Video webcam visibile per test -->
  <video id="webcamVideo" autoplay playsinline muted></video>

  <a-scene embedded style="width: 100vw; height: 100vh;">
    <a-entity id="semiContainer"></a-entity>
    <a-entity camera position="0 1.6 0"></a-entity>
  </a-scene>

<script>
  // Prendo il video HTML5 e provo ad attivare la webcam
  const video = document.getElementById('webcamVideo');
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      video.srcObject = stream;
      video.play();
      console.log("Webcam attiva");
    })
    .catch(err => {
      console.error("Errore accesso webcam:", err);
    });

  // Creo semi semplici con A-Frame
  const semiContainer = document.querySelector('#semiContainer');
  const semiData = [];

  for(let i=0; i<10; i++) {
    const angle = Math.random() * 2 * Math.PI;
    const distance = 1 + Math.random();
    const y = Math.random() * 2;

    const aImg = document.createElement('a-box');
    aImg.setAttribute('color', 'yellow');
    aImg.setAttribute('depth', 0.1);
    aImg.setAttribute('height', 0.1);
    aImg.setAttribute('width', 0.1);
    aImg.setAttribute('position', `${Math.cos(angle)*distance} ${y} ${Math.sin(angle)*distance}`);

    semiContainer.appendChild(aImg);

    semiData.push({
      el: aImg,
      basePos: { x: Math.cos(angle)*distance, y: y, z: Math.sin(angle)*distance },
      speed: 0.5 + Math.random(),
      phase: Math.random() * Math.PI * 2
    });
  }

  AFRAME.registerComponent('float-seeds', {
    tick: function(time) {
      const t = time / 1000;
      semiData.forEach(s => {
        const ox = Math.sin(t * s.speed + s.phase) * 0.2;
        const oy = Math.cos(t * s.speed * 0.5 + s.phase) * 0.1;
        const oz = Math.sin(t * s.speed + s.phase) * 0.2;

        s.el.setAttribute('position', `${s.basePos.x + ox} ${s.basePos.y + oy} ${s.basePos.z + oz}`);
      });
    }
  });

  semiContainer.setAttribute('float-seeds', '');
</script>

</body>
</html>
